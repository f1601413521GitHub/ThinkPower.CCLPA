@model ThinkPower.CCLPA.Web.ViewModels.PreAdjustImportViewModel

@{
    ViewBag.Title = "專案臨調預審名單匯入";
}




<div class="row">
    <div class="col col-auto">
        <h3>專案臨調預審名單匯入</h3>
    </div>
</div>




<hr />
<div class="row">
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
</div>





@using (Html.BeginForm("Validate", "PreAdjust", FormMethod.Get))
{
    <div class="row">
        <div class="col col-auto">
            <span>ILRC行銷活動編碼</span>
        </div>

        <div class="col col-auto">
            @Html.TextBox("CampaignId", null, new { @class = "form-control" })
        </div>

        <div class="col col-auto">
            <input type="submit" value="名單匯入" class="btn btn-success" />
        </div>
    </div>
    <hr />
    <div class="row">
        <div class="col col-auto text-danger">
            <span>說明：請先於ILRC提案，上雙向簡訊、預審名單</span>
        </div>
    </div>
}





<div class="row">

    @if (Model != null)
    {
        string tipTitle = null;
        string tipMessage = null;
        bool executeImport = false;

        if (Model.ExecuteImport)
        {
            tipTitle = "提示訊息";
            tipMessage = "名單匯入完成";
        }
        else if (!String.IsNullOrEmpty(Model.ErrorMessage))
        {
            tipTitle = "檢核錯誤提示訊息";
            tipMessage = Model.ErrorMessage;
        }
        else if (String.IsNullOrEmpty(Model.ErrorMessage))
        {
            if (Model.CampaignDetailCount > 0)
            {
                tipTitle = "提示訊息";
                tipMessage = $"您確定要將行銷活動編號「{Model.CampaignId}」合計{Model.CampaignDetailCount}筆資料，進行匯入作業嗎?";
                executeImport = true;
            }
            else
            {
                tipTitle = "檢核提示訊息";
                tipMessage = "行銷活動編號已失效或無可匯入名單。";
            }
        }

        <div class="modal" tabindex="-1" role="dialog" id="tip-modal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">@tipTitle</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>@tipMessage</p>
                    </div>
                    <div class="modal-footer">
                        @if (Model.ExecuteImport)
                        {
                            @Html.ActionLink("確定", "Index", "PreAdjust", new { }, new { @class = "btn btn-primary" })
                        }
                        else if (executeImport)
                        {
                            @Html.ActionLink("確定", "Import", "PreAdjust", new { CampaignId = Model.CampaignId, ExecuteImport = executeImport }, new { @class = "btn btn-primary" })
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                        }
                        else
                        {
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">確定</button>
                        }
                    </div>
                </div>
            </div>
        </div>
    }

</div>





@section scripts{
    <script src="~/Scripts/PreAdjustImport.js"></script>
}